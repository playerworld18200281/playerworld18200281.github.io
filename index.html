<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>SKR EOS</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
	<link rel="stylesheet" type="text/css" href="./static/eos.css">
	<!--<script src="static/eos.js"></script>-->
    <!--<script src="js/jquery.1.11.3.js"></script>-->
	<!--<script src="js/scatterjs-core.min.js"></script>-->
	<!--<script src="js/scatterjs-plugin-eosjs.min.js"></script>-->
	<!--<script src="js/scatterjs-plugin-eosjs2.min.js"></script>-->
	<!--<script src="js/scatterjs-plugin-web3.min.js"></script>-->
	<!--<script src="js/scatterjs-plugin-tron.min.js"></script>-->
    <script src='js/eosjs-api.js'></script>
    <script src='js/eosjs-jsonrpc.js'></script>
    <script src='js/eosjs-jssig.js'></script>

</head>
<body>
<a href="#" style="display: none;" id="user_loginout" onclick="loginout()">退出</a>
<a href="#" id="user_login" onclick="index()">登录</a>
<!--<p id="name_id"></p>-->
<pre style="width: 100%; height: 100%; margin:0px; "></pre>


<script>
    let pre = document.getElementsByTagName('pre')[0];
    const defaultPrivateKey = "5KN4ZJCfkZ89o5LyXRgjmoz1xFWxB3pE7DuFhMwUpKBR3qFyZA7"; // bob
    const rpc = new eosjs_jsonrpc.JsonRpc('http://jungle2.cryptolions.io');
    const signatureProvider = new eosjs_jssig.JsSignatureProvider([defaultPrivateKey]);
    const api = new eosjs_api.Api({ rpc, signatureProvider });
    (async () => {
        try {
            const result = await api.transact({
            actions: [{
                account: 'playerworld5',
                name: 'hi',
                authorization: [{
                    actor: 'playerworld5',
                    permission: 'active',
                }],
                data: {
                    user: 'bob',
                },
            }]
        }, {
            blocksBehind: 3,
            expireSeconds: 30,
        });
    pre.textContent += JSON.stringify(result, null, 2);
    } catch (e) {
        console.log(e);
        pre.textContent = '\n抛异常: ' + e;
        if (e instanceof eosjs_jsonrpc.RpcError)
            console.log(e.json);
            pre.textContent += '\n\n' + JSON.stringify(e.json, null, 2);
    }
    })();
</script>
<script>

    function loginout() {
        // Don't forget to tell ScatterJS which plugins you are using.
        ScatterJS.plugins( new ScatterEOS() );

        // Networks are used to reference certain blockchains.
        // They let you get accounts and help you build signature providers.
        const network = {
            blockchain:'eos',
            protocol:'https',
            host:'nodes.get-scatter.com',
            port:443,
            chainId:'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906'
        }

        // First we need to connect to the user's Scatter.
        ScatterJS.scatter.connect('My-App').then(connected => {

            // If the user does not have Scatter or it is Locked or Closed this will return false;
            if(!connected) return false;

        const scatter = ScatterJS.scatter;
        scatter.forgetIdentity()

// The latest scatter-js will also allow using:
        var s = scatter.logout()
        console.log(scatter);
        console.log(s);
        $("#user_login").html('登录');
        $("#user_loginout").hide();
    });
    }
    function index() {

        // Don't forget to tell ScatterJS which plugins you are using.
        ScatterJS.plugins( new ScatterEOS() );

        // Networks are used to reference certain blockchains.
        // They let you get accounts and help you build signature providers.
        const network = {
            blockchain:'eos',
            protocol:'https',
            host:'nodes.get-scatter.com',
            port:443,
            chainId:'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906'
        }

        // First we need to connect to the user's Scatter.
        ScatterJS.scatter.connect('My-App').then(connected => {

            // If the user does not have Scatter or it is Locked or Closed this will return false;
            if(!connected) return false;

        const scatter = ScatterJS.scatter;

        // Now we need to get an identity from the user.
        // We're also going to require an account that is connected to the network we're using.
        const requiredFields = { accounts:[network] };
        scatter.getIdentity(requiredFields).then(() => {

            // Always use the accounts you got back from Scatter. Never hardcode them even if you are prompting
            // the user for their account name beforehand. They could still give you a different account.
            const account = scatter.identity.accounts.find(x => x.blockchain === 'eos');

        // You can pass in any additional options you want into the eosjs reference.
        const eosOptions = { expireInSeconds:60 };

        // Get a proxy reference to eosjs which you can use to sign transactions with a user's Scatter.
//    const eos = scatter.eos(network, Eos, eosOptions);

        // ----------------------------
        // Now that we have an identity,
        // an EOSIO account, and a reference
        // to an eosjs object we can send a transaction.
        // ----------------------------


        // Never assume the account's permission/authority. Always take it from the returned account.
        const transactionOptions = { authorization:[`${account.name}@${account.authority}`] };
//        console.log(transactionOptions);
        console.log(account.name);
        $("#user_login").html(account.name);
        $("#user_loginout").show();
// eos.transfer(account.name, 'helloworld', '1.0000 EOS', 'memo', transactionOptions).then(trx => {
//            // That's it!
//
//            console.log(`Transaction ID: ${trx.transaction_id}`);
//    }).catch(error => {
//            console.error(error);
//    });

    }).catch(error => {
            // The user rejected this request, or doesn't have the appropriate requirements.
            console.error(error);
    });
    });
    }
</script>

</body>

</html>